## ----setup, include=FALSE--------------------------------------------------------------------------------------------
knitr::opts_chunk$set(echo = TRUE, error = TRUE)
library(Lock5Data)
library(tidyverse)
library(infer)


## ----data-load-------------------------------------------------------------------------------------------------------
GSS <- read_csv("data/GSS_clean.csv")


## --------------------------------------------------------------------------------------------------------------------
GSS <- GSS %>%
  drop_na(self_emp_or_works_for_somebody)


## --------------------------------------------------------------------------------------------------------------------
GSS %>%
  group_by(self_emp_or_works_for_somebody) %>%
  summarize(n = n()) %>%
  mutate(prop = n/sum(n))


## --------------------------------------------------------------------------------------------------------------------
GSS %>% 
  prop_test(response = self_emp_or_works_for_somebody, 
            alternative = "greater", p = 0.1)


## --------------------------------------------------------------------------------------------------------------------
GSS %>% 
  prop_test(response = self_emp_or_works_for_somebody, 
            conf_int = TRUE)


## --------------------------------------------------------------------------------------------------------------------
sqrt((0.1*0.9)/2261)


## --------------------------------------------------------------------------------------------------------------------
(0.103-0.1)/0.006309152


## --------------------------------------------------------------------------------------------------------------------
1-pnorm(0.4754997)


## --------------------------------------------------------------------------------------------------------------------
GSS %>%
  group_by(self_emp_or_works_for_somebody) %>%
  summarize(n = n()) %>%
  mutate(prop = n / sum(n), total = sum(n)) %>%
  filter(self_emp_or_works_for_somebody == "Self-employed") %>%
  mutate(se = sqrt(prop * (1 - prop) / total)) %>%
  mutate(z_stat = (prop - 0.1) / se) %>%
  mutate(pvalue = pnorm(z_stat, lower.tail = FALSE))


## --------------------------------------------------------------------------------------------------------------------
sqrt((0.103*(1-0.103))/2261)


## --------------------------------------------------------------------------------------------------------------------
qnorm(0.975)


## --------------------------------------------------------------------------------------------------------------------
0.103 - 1.96 * 0.00639
0.103 + 1.96 * 0.00639


## --------------------------------------------------------------------------------------------------------------------
GSS %>%
  group_by(self_emp_or_works_for_somebody) %>%
  summarize(n = n()) %>%
  mutate(prop = n / sum(n), total = sum(n)) %>%
  filter(self_emp_or_works_for_somebody == "Self-employed") %>%
  mutate(
    se = sqrt(prop * (1 - prop) / total),
    critical_z = 1.96,
    me = critical_z * se
  ) %>%
  mutate(low = prop - me, high = prop + me)

